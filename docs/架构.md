# SSID代理系统架构文档

## 系统概述
SSID代理系统是一个基于OpenWrt的轻量级代理管理解决方案，采用前后端分离架构设计。系统允许用户根据网络接口配置不同的代理规则，提供状态监控、日志查看和高级监控功能。

## 架构设计

### 1. 整体架构
```
+-------------------+     +-------------------+     +-------------------+
|   前端界面        |     |   LuCI API        |     |   核心服务        |
| (HTML/CSS/JS)     |<--->| (Lua)             |<--->| (Shell脚本)       |
+-------------------+     +-------------------+     +-------------------+
       ↑                             ↑                         ↑
       |                             |                         |
+-------------------+         +-------------------+     +-------------------+
|   用户浏览器      |         |   UCI配置系统     |     |   iptables防火墙  |
+-------------------+         +-------------------+     +-------------------+
```

### 2. 前端架构
- **单页面应用(SPA)**：基于Hash路由
- **模块化设计**：
  - 全局资源(base.css, utils.js)
  - 页面专属资源(各页面的CSS/JS/HTML)
  - 使用 es6 的 import 和export 来按需加载
- **动态加载**：按需加载页面资源
- **全局监控**：底部固定状态栏
- **响应式设计**：适应不同屏幕尺寸

### 3. 后端架构
- **LuCI API**：提供RESTful接口
- **UCI配置管理**：处理持久化配置
- **核心服务**：`ssid-proxy`脚本实现代理功能
- **日志系统**：多级别日志记录

### 4. 核心组件
1. **配置管理**：规则增删改查
2. **服务控制**：启动/停止/重启
3. **状态监控**：实时系统状态
4. **日志系统**：日志查看和清理
5. **防火墙集成**：通过iptables实现代理规则

### 5. 数据流
1. 前端发起API请求
2. LuCI处理请求并操作UCI配置
3. 核心服务读取配置并应用防火墙规则
4. 服务监控连接状态并记录日志
5. 日志数据通过API返回前端

## 目录结构
```
ssid-proxy/
├── index.html              # 主入口文件
├── css/                    # 样式文件
│   ├── base.css            # 基础样式
│   ├── style.css           # 全局组件样式
│   └── pages/              # 页面专属样式
│       ├── config.css      # 配置页样式
│       ├── logs.css        # 日志页样式
│       ├── monitor.css     # 监控页样式
│       └── status.css      # 状态页样式
│       └── nodes.css      # 服务器节点页样式
├── js/                     # JavaScript脚本
│   ├── utils.js            # 工具函数
│   ├── router.js           # 路由系统
│   ├── template.js         # 模板引擎
│   ├── global.js           # 全局状态管理
│   └── pages/              # 页面专属逻辑
│       ├── config.js       # 配置页逻辑
│       ├── logs.js         # 日志页逻辑
│       ├── monitor.js      # 监控页逻辑
│       └── status.js       # 状态页逻辑
│       └── nodes.js      # 服务器节点页逻辑
├── pages/                  # HTML页面片段
│   ├── config.html         # 配置页片段
│   ├── logs.html           # 日志页片段
│   ├── monitor.html        # 监控页片段
│   └── status.html         # 状态页片段
│   └── nodes.html          # 服务器节点页片段
├── api/                    # 后端API
│   ├── config.lua          # 配置API
│   ├── logs.lua            # 日志API
│   ├── monitor.lua         # 监控API
│   └── status.lua          # 状态API
├── sbin/                   # 核心脚本
│   ├── ssid-proxy          # 主服务脚本
│   └── ssid-proxy-validate # 配置验证脚本
└── ssid-proxy.lua          # LuCI主控制器
```

## 工作流程
1. 用户访问前端界面
2. 路由系统加载对应页面
3. 页面初始化时请求API获取数据
4. 用户操作触发API调用
5. 后端处理请求并返回结果
6. 前端更新界面显示结果

## 部署方式
1. 通过`install.sh`脚本安装
2. 服务部署到`/usr/sbin/ssid-proxy`
3. Web资源部署到LuCI静态目录
4. API部署到LuCI控制器目录