<%+header%>
<style>
.monitor-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.monitor-panel {
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    padding: 20px;
    height: 100%;
    overflow: hidden;
}

.panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
}

.panel-title {
    font-size: 1.2em;
    font-weight: bold;
    color: #333;
}

.panel-actions {
    display: flex;
    gap: 10px;
}

.panel-btn {
    background: #f5f5f5;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 5px 10px;
    font-size: 0.85em;
    cursor: pointer;
    transition: all 0.2s;
}

.panel-btn:hover {
    background: #e9e9e9;
}

.map-container {
    height: 300px;
    background: #eef7ff;
    border-radius: 6px;
    overflow: hidden;
    position: relative;
}

.map-placeholder {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
    color: #666;
    font-style: italic;
}

.connection-dot {
    position: absolute;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #ff5722;
    box-shadow: 0 0 0 4px rgba(255, 87, 34, 0.3);
    transform: translate(-50%, -50%);
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(255, 87, 34, 0.4); }
    70% { box-shadow: 0 0 0 10px rgba(255, 87, 34, 0); }
    100% { box-shadow: 0 0 0 0 rgba(255, 87, 34, 0); }
}

.connection-line {
    position: absolute;
    background: rgba(255, 87, 34, 0.3);
    height: 2px;
    transform-origin: left center;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-top: 15px;
}

.stat-card {
    background: #f9f9f9;
    border-radius: 6px;
    padding: 15px;
    text-align: center;
}

.stat-value {
    font-size: 1.8em;
    font-weight: bold;
    margin: 10px 0;
}

.stat-label {
    color: #666;
    font-size: 0.9em;
}

.gauge-container {
    height: 150px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.traffic-chart {
    height: 200px;
    margin-top: 15px;
}

.client-list {
    max-height: 300px;
    overflow-y: auto;
}

.client-item {
    display: flex;
    align-items: center;
    padding: 10px;
    border-bottom: 1px solid #eee;
}

.client-item:last-child {
    border-bottom: none;
}

.client-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #e0e0e0;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-right: 15px;
    font-size: 1.2em;
}

.client-info {
    flex: 1;
}

.client-name {
    font-weight: bold;
}

.client-details {
    font-size: 0.85em;
    color: #666;
    margin-top: 3px;
}

.client-traffic {
    text-align: right;
    font-weight: bold;
}

.domain-list {
    max-height: 300px;
    overflow-y: auto;
}

.domain-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 10px;
    border-bottom: 1px solid #eee;
}

.domain-item:last-child {
    border-bottom: none;
}

.domain-name {
    display: flex;
    align-items: center;
}

.domain-icon {
    width: 24px;
    height: 24px;
    margin-right: 10px;
    background: #e0e0e0;
    border-radius: 4px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 0.8em;
}

.domain-stats {
    display: flex;
    gap: 15px;
}

.domain-traffic {
    min-width: 80px;
    text-align: right;
}

.traffic-bar {
    height: 5px;
    background: #e0e0e0;
    border-radius: 3px;
    margin-top: 5px;
    overflow: hidden;
}

.traffic-fill {
    height: 100%;
    background: #4CAF50;
}

.connections-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9em;
}

.connections-table th {
    background-color: #f2f2f2;
    text-align: left;
    padding: 10px;
    border-bottom: 2px solid #ddd;
}

.connections-table td {
    padding: 8px 10px;
    border-bottom: 1px solid #eee;
}

.connections-table tr:hover {
    background-color: #f9f9f9;
}

.traffic-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.8em;
}

.traffic-in {
    background-color: #e3f2fd;
    color: #0d47a1;
}

.traffic-out {
    background-color: #e8f5e9;
    color: #1b5e20;
}

.status-indicator {
    display: inline-block;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin-right: 5px;
}

.status-active {
    background-color: #4CAF50;
}

.status-idle {
    background-color: #FFC107;
}

.status-closing {
    background-color: #F44336;
}

.world-map {
    width: 100%;
    height: 100%;
    background-image: url("/luci-static/resources/icons/world-map.svg");
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    position: relative;
}

.interface-tag {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.8em;
    margin-left: 8px;
}

.tag-wireless {
    background-color: #f3e5f5;
    color: #6a1b9a;
    border: 1px solid #ce93d8;
}

.tag-ethernet {
    background-color: #e3f2fd;
    color: #0d47a1;
    border: 1px solid #90caf9;
}

.tag-bridge {
    background-color: #e8f5e9;
    color: #1b5e20;
    border: 1px solid #a5d6a7;
}

.tag-vlan {
    background-color: #fff8e1;
    color: #7d6608;
    border: 1px solid #ffe082;
}

.interface-status {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 5px;
}

.interface-up {
    background-color: #4CAF50;
}

.interface-down {
    background-color: #F44336;
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 1200px) {
    .monitor-container {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
// æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆå‡½æ•°
function generateMockData() {
    return {
        connections: [
            { id: 1, client: '192.168.1.101', device: 'å®‰å“æ‰‹æœº', country: 'CN', target: 'google.com:443', duration: '2åˆ†15ç§’', trafficIn: '1.2MB', trafficOut: '0.8MB', status: 'active', interface: 'br-lan', ifaceType: 'bridge' },
            { id: 2, client: '192.168.1.102', device: 'Windows PC', country: 'US', target: 'youtube.com:443', duration: '5åˆ†42ç§’', trafficIn: '4.7MB', trafficOut: '1.1MB', status: 'active', interface: 'eth0.2', ifaceType: 'vlan' },
            { id: 3, client: '192.168.1.103', device: 'iPhone', country: 'JP', target: 'apple.com:443', duration: '1åˆ†03ç§’', trafficIn: '0.5MB', trafficOut: '0.2MB', status: 'idle', interface: 'wlan0', ifaceType: 'wireless' },
            { id: 4, client: '192.168.1.104', device: 'MacBook', country: 'GB', target: 'github.com:443', duration: '3åˆ†28ç§’', trafficIn: '2.1MB', trafficOut: '0.9MB', status: 'closing', interface: 'eth1', ifaceType: 'ethernet' },
            { id: 5, client: '192.168.1.105', device: 'iPad', country: 'DE', target: 'netflix.com:443', duration: '8åˆ†12ç§’', trafficIn: '6.3MB', trafficOut: '1.5MB', status: 'active', interface: 'br-guest', ifaceType: 'bridge' }
        ],
        clients: [
            { id: 1, name: 'å¼ ä¸‰çš„æ‰‹æœº', ip: '192.168.1.101', device: 'å®‰å“', os: 'Android 12', traffic: '2.1GB', interface: 'br-lan' },
            { id: 2, name: 'æå››çš„ç¬”è®°æœ¬', ip: '192.168.1.102', device: 'Windows PC', os: 'Windows 11', traffic: '4.7GB', interface: 'eth0.2' },
            { id: 3, name: 'ç‹äº”çš„å¹³æ¿', ip: '192.168.1.103', device: 'iPad', os: 'iOS 15', traffic: '1.2GB', interface: 'wlan0' },
            { id: 4, name: 'å®¢å…ç”µè§†', ip: '192.168.1.104', device: 'æ™ºèƒ½ç”µè§†', os: 'Android TV', traffic: '3.5GB', interface: 'eth1' },
            { id: 5, name: 'èµµå…­çš„å·¥ä½œç«™', ip: '192.168.1.105', device: 'Mac Mini', os: 'macOS 12', traffic: '5.8GB', interface: 'br-guest' }
        ],
        domains: [
            { id: 1, name: 'youtube.com', category: 'è§†é¢‘', traffic: '8.4GB', percentage: 35, interface: 'br-lan' },
            { id: 2, name: 'netflix.com', category: 'è§†é¢‘', traffic: '6.2GB', percentage: 26, interface: 'eth0.2' },
            { id: 3, name: 'google.com', category: 'æœç´¢', traffic: '3.1GB', percentage: 13, interface: 'wlan0' },
            { id: 4, name: 'amazon.com', category: 'è´­ç‰©', traffic: '2.4GB', percentage: 10, interface: 'eth1' },
            { id: 5, name: 'github.com', category: 'å¼€å‘', traffic: '1.8GB', percentage: 7, interface: 'br-guest' },
            { id: 6, name: 'steampowered.com', category: 'æ¸¸æˆ', traffic: '1.2GB', percentage: 5, interface: 'br-lan' },
            { id: 7, name: 'å…¶ä»–', category: 'å…¶ä»–', traffic: '1.1GB', percentage: 4, interface: 'eth0.2' }
        ],
        stats: {
            cpu: 42,
            memory: 65,
            latency: 28,
            successRate: 98.7,
            activeConnections: 12,
            dailyTraffic: '24.3GB'
        }
    };
}

// è·å–æ¥å£ç±»å‹æ ‡ç­¾
function getInterfaceTag(type) {
    const types = {
        'wireless': { class: 'tag-wireless', text: 'æ— çº¿' },
        'ethernet': { class: 'tag-ethernet', text: 'æœ‰çº¿' },
        'bridge': { class: 'tag-bridge', text: 'ç½‘æ¡¥' },
        'vlan': { class: 'tag-vlan', text: 'VLAN' }
    };
    
    const info = types[type] || { class: '', text: 'å…¶ä»–' };
    return `<span class="interface-tag ${info.class}">${info.text}</span>`;
}

// åˆå§‹åŒ–ç›‘æ§é¡µé¢
function initMonitor() {
    const data = generateMockData();
    
    // æ›´æ–°æ€§èƒ½æŒ‡æ ‡
    updatePerformanceStats(data.stats);
    
    // æ¸²æŸ“è¿æ¥åœ°å›¾
    renderConnectionMap(data.connections);
    
    // æ¸²æŸ“å®¢æˆ·ç«¯åˆ—è¡¨
    renderClientList(data.clients);
    
    // æ¸²æŸ“åŸŸåæ’è¡Œ
    renderDomainRanking(data.domains);
    
    // æ¸²æŸ“æ´»è·ƒè¿æ¥
    renderActiveConnections(data.connections);
    
    // å¯åŠ¨å®æ—¶æ›´æ–°
    setInterval(updateRealTimeData, 5000);
}

// æ›´æ–°æ€§èƒ½æŒ‡æ ‡
function updatePerformanceStats(stats) {
    document.getElementById('cpu-value').textContent = stats.cpu + '%';
    document.getElementById('memory-value').textContent = stats.memory + '%';
    document.getElementById('latency-value').textContent = stats.latency + 'ms';
    document.getElementById('success-value').textContent = stats.successRate + '%';
    document.getElementById('connections-value').textContent = stats.activeConnections;
    document.getElementById('traffic-value').textContent = stats.dailyTraffic;
    
    // æ›´æ–°ä»ªè¡¨ç›˜
    updateGauge('cpu-gauge', stats.cpu);
    updateGauge('memory-gauge', stats.memory);
    updateGauge('latency-gauge', Math.min(stats.latency, 100));
    updateGauge('success-gauge', stats.successRate);
}

// æ›´æ–°ä»ªè¡¨ç›˜
function updateGauge(id, value) {
    const gauge = document.getElementById(id);
    if (!gauge) return;
    
    // æ¸…é™¤æ—§å†…å®¹
    gauge.innerHTML = '';
    
    // åˆ›å»ºSVGä»ªè¡¨ç›˜
    const svgNS = "http://www.w3.org/2000/svg";
    const svg = document.createElementNS(svgNS, "svg");
    svg.setAttribute("width", "120");
    svg.setAttribute("height", "80");
    svg.setAttribute("viewBox", "0 0 120 80");
    
    // ä»ªè¡¨ç›˜èƒŒæ™¯
    const bgArc = document.createElementNS(svgNS, "path");
    bgArc.setAttribute("d", "M20,70 A50,50 0 0,1 100,70");
    bgArc.setAttribute("fill", "none");
    bgArc.setAttribute("stroke", "#e0e0e0");
    bgArc.setAttribute("stroke-width", "10");
    svg.appendChild(bgArc);
    
    // ä»ªè¡¨ç›˜å€¼
    const valueArc = document.createElementNS(svgNS, "path");
    const startAngle = 180;
    const endAngle = 180 + (value / 100) * 180;
    const startRad = (startAngle * Math.PI) / 180;
    const endRad = (endAngle * Math.PI) / 180;
    const x1 = 60 + 50 * Math.cos(startRad);
    const y1 = 70 + 50 * Math.sin(startRad);
    const x2 = 60 + 50 * Math.cos(endRad);
    const y2 = 70 + 50 * Math.sin(endRad);
    
    valueArc.setAttribute("d", `M${x1},${y1} A50,50 0 0,1 ${x2},${y2}`);
    valueArc.setAttribute("fill", "none");
    valueArc.setAttribute("stroke", getGaugeColor(id, value));
    valueArc.setAttribute("stroke-width", "10");
    valueArc.setAttribute("stroke-linecap", "round");
    svg.appendChild(valueArc);
    
    // ä»ªè¡¨ç›˜æŒ‡é’ˆ
    const pointer = document.createElementNS(svgNS, "line");
    pointer.setAttribute("x1", "60");
    pointer.setAttribute("y1", "70");
    pointer.setAttribute("x2", x2);
    pointer.setAttribute("y2", y2);
    pointer.setAttribute("stroke", "#333");
    pointer.setAttribute("stroke-width", "2");
    svg.appendChild(pointer);
    
    // ä»ªè¡¨ç›˜ä¸­å¿ƒç‚¹
    const center = document.createElementNS(svgNS, "circle");
    center.setAttribute("cx", "60");
    center.setAttribute("cy", "70");
    center.setAttribute("r", "4");
    center.setAttribute("fill", "#333");
    svg.appendChild(center);
    
    // æ·»åŠ å€¼æ–‡æœ¬
    const text = document.createElementNS(svgNS, "text");
    text.setAttribute("x", "60");
    text.setAttribute("y", "50");
    text.setAttribute("text-anchor", "middle");
    text.setAttribute("font-size", "14");
    text.setAttribute("fill", "#333");
    text.textContent = value + (id === 'latency-gauge' ? 'ms' : '%');
    svg.appendChild(text);
    
    gauge.appendChild(svg);
}

// è·å–ä»ªè¡¨ç›˜é¢œè‰²
function getGaugeColor(id, value) {
    if (id === 'cpu-gauge' || id === 'memory-gauge') {
        if (value < 50) return '#4CAF50';
        if (value < 75) return '#FFC107';
        return '#F44336';
    }
    
    if (id === 'latency-gauge') {
        if (value < 30) return '#4CAF50';
        if (value < 60) return '#FFC107';
        return '#F44336';
    }
    
    if (id === 'success-gauge') {
        if (value > 95) return '#4CAF50';
        if (value > 90) return '#FFC107';
        return '#F44336';
    }
    
    return '#2196F3';
}

// æ¸²æŸ“è¿æ¥åœ°å›¾
function renderConnectionMap(connections) {
    const mapContainer = document.getElementById('connection-map');
    if (!mapContainer) return;
    
    // æ¸…é™¤æ—§å†…å®¹
    mapContainer.innerHTML = '<div class="world-map"></div>';
    const worldMap = mapContainer.querySelector('.world-map');
    
    // å›½å®¶åæ ‡æ˜ å°„ï¼ˆç®€åŒ–çš„åæ ‡ï¼‰
    const countryCoords = {
        'CN': { x: 75, y: 40 },
        'US': { x: 25, y: 35 },
        'JP': { x: 85, y: 35 },
        'GB': { x: 48, y: 30 },
        'DE': { x: 52, y: 30 },
        'FR': { x: 50, y: 32 },
        'RU': { x: 65, y: 25 },
        'BR': { x: 35, y: 60 },
        'IN': { x: 70, y: 45 },
        'AU': { x: 90, y: 70 }
    };
    
    // æ·»åŠ è¿æ¥ç‚¹
    connections.forEach(conn => {
        if (countryCoords[conn.country]) {
            const coords = countryCoords[conn.country];
            
            // åˆ›å»ºè¿æ¥ç‚¹
            const dot = document.createElement('div');
            dot.className = 'connection-dot';
            dot.style.left = coords.x + '%';
            dot.style.top = coords.y + '%';
            dot.title = `${conn.country}: ${conn.target} (æ¥å£: ${conn.interface})`;
            worldMap.appendChild(dot);
            
            // åˆ›å»ºè¿æ¥åˆ°ä¸­å›½çš„çº¿
            const line = document.createElement('div');
            line.className = 'connection-line';
            line.style.left = '50%';
            line.style.top = '50%';
            
            // è®¡ç®—çº¿çš„é•¿åº¦å’Œè§’åº¦
            const dx = coords.x - 50;
            const dy = coords.y - 50;
            const length = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            line.style.width = length + '%';
            line.style.transform = `rotate(${angle}deg)`;
            worldMap.appendChild(line);
        }
    });
    
    // æ·»åŠ ä¸­å›½ä¸­å¿ƒç‚¹
    const centerDot = document.createElement('div');
    centerDot.className = 'connection-dot';
    centerDot.style.backgroundColor = '#2196F3';
    centerDot.style.boxShadow = '0 0 0 4px rgba(33, 150, 243, 0.3)';
    centerDot.style.left = '50%';
    centerDot.style.top = '50%';
    centerDot.title = 'ä¸­å›½ (è·¯ç”±å™¨ä½ç½®)';
    worldMap.appendChild(centerDot);
}

// æ¸²æŸ“å®¢æˆ·ç«¯åˆ—è¡¨
function renderClientList(clients) {
    const container = document.getElementById('client-list');
    if (!container) return;
    
    container.innerHTML = '';
    
    clients.forEach(client => {
        const item = document.createElement('div');
        item.className = 'client-item';
        
        // è®¾å¤‡ç±»å‹å›¾æ ‡
        const deviceIcons = {
            'Windows PC': 'ğŸ’»',
            'Mac Mini': 'ğŸ–¥ï¸',
            'å®‰å“æ‰‹æœº': 'ğŸ“±',
            'iPhone': 'ğŸ“±',
            'iPad': 'ğŸ“±',
            'æ™ºèƒ½ç”µè§†': 'ğŸ“º'
        };
        
        const icon = deviceIcons[client.device] || 'ğŸ“¶';
        
        // æ¥å£æ ‡ç­¾
        const ifaceTag = getInterfaceTag(client.ifaceType || 'ethernet');
        
        item.innerHTML = `
            <div class="client-avatar">${icon}</div>
            <div class="client-info">
                <div class="client-name">${client.name}</div>
                <div class="client-details">${client.device} | ${client.os} | ${client.ip}</div>
                <div class="client-interface">
                    <span class="interface-tag ${client.ifaceType ? 'tag-' + client.ifaceType : 'tag-ethernet'}">
                        ${client.interface}
                    </span>
                </div>
            </div>
            <div class="client-traffic">${client.traffic}</div>
        `;
        
        container.appendChild(item);
    });
}

// æ¸²æŸ“åŸŸåæ’è¡Œ
function renderDomainRanking(domains) {
    const container = document.getElementById('domain-ranking');
    if (!container) return;
    
    container.innerHTML = '';
    
    domains.forEach(domain => {
        const item = document.createElement('div');
        item.className = 'domain-item';
        
        // ç±»åˆ«å›¾æ ‡
        const categoryIcons = {
            'è§†é¢‘': 'ğŸ¬',
            'æœç´¢': 'ğŸ”',
            'è´­ç‰©': 'ğŸ›’',
            'å¼€å‘': 'ğŸ’»',
            'æ¸¸æˆ': 'ğŸ®',
            'ç¤¾äº¤': 'ğŸ‘¥',
            'å…¶ä»–': 'ğŸŒ'
        };
        
        const icon = categoryIcons[domain.category] || 'ğŸŒ';
        
        // æ¥å£æ ‡ç­¾
        const ifaceTag = getInterfaceTag(domain.ifaceType || 'ethernet');
        
        item.innerHTML = `
            <div class="domain-name">
                <div class="domain-icon">${icon}</div>
                <div>
                    <div>${domain.name}</div>
                    <div style="font-size:0.8em;color:#888;">${domain.category}</div>
                    <div style="font-size:0.75em;margin-top:3px;">
                        <span class="interface-tag ${domain.ifaceType ? 'tag-' + domain.ifaceType : 'tag-ethernet'}">
                            ${domain.interface}
                        </span>
                    </div>
                </div>
            </div>
            <div class="domain-stats">
                <div class="domain-traffic">${domain.traffic}</div>
                <div style="min-width:100px;">
                    <div>${domain.percentage}%</div>
                    <div class="traffic-bar">
                        <div class="traffic-fill" style="width:${domain.percentage}%"></div>
                    </div>
                </div>
            </div>
        `;
        
        container.appendChild(item);
    });
}

// æ¸²æŸ“æ´»è·ƒè¿æ¥
function renderActiveConnections(connections) {
    const container = document.getElementById('active-connections');
    if (!container) return;
    
    container.innerHTML = '';
    
    // åˆ›å»ºè¡¨æ ¼
    const table = document.createElement('table');
    table.className = 'connections-table';
    
    // è¡¨å¤´
    table.innerHTML = `
        <thead>
            <tr>
                <th>å®¢æˆ·ç«¯</th>
                <th>è®¾å¤‡</th>
                <th>ç›®æ ‡åœ°å€</th>
                <th>å›½å®¶</th>
                <th>æ¥å£</th>
                <th>æŒç»­æ—¶é—´</th>
                <th>æµé‡</th>
                <th>çŠ¶æ€</th>
            </tr>
        </thead>
        <tbody></tbody>
    `;
    
    const tbody = table.querySelector('tbody');
    
    // æ·»åŠ è¡Œ
    connections.forEach(conn => {
        const row = document.createElement('tr');
        
        // çŠ¶æ€æŒ‡ç¤ºå™¨
        const statusClass = {
            'active': 'status-active',
            'idle': 'status-idle',
            'closing': 'status-closing'
        }[conn.status] || '';
        
        const statusText = {
            'active': 'æ´»è·ƒ',
            'idle': 'ç©ºé—²',
            'closing': 'å…³é—­ä¸­'
        }[conn.status] || conn.status;
        
        // æ¥å£æ ‡ç­¾
        const ifaceTag = getInterfaceTag(conn.ifaceType || 'ethernet');
        
        row.innerHTML = `
            <td>${conn.client}</td>
            <td>${conn.device}</td>
            <td>${conn.target}</td>
            <td>${conn.country}</td>
            <td>
                <span class="interface-tag ${conn.ifaceType ? 'tag-' + conn.ifaceType : 'tag-ethernet'}">
                    ${conn.interface}
                </span>
            </td>
            <td>${conn.duration}</td>
            <td>
                <span class="traffic-badge traffic-in">${conn.trafficIn} å…¥</span>
                <span class="traffic-badge traffic-out">${conn.trafficOut} å‡º</span>
            </td>
            <td>
                <span class="status-indicator ${statusClass}"></span>
                ${statusText}
            </td>
        `;
        
        tbody.appendChild(row);
    });
    
    container.appendChild(table);
}

// å®æ—¶æ›´æ–°æ•°æ®
function updateRealTimeData() {
    // è¿™é‡Œåº”è¯¥æ˜¯ä»æœåŠ¡å™¨è·å–å®æ—¶æ•°æ®
    // ç°åœ¨ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
    const data = generateMockData();
    
    // éšæœºæ›´æ–°ä¸€äº›å€¼
    data.stats.cpu = Math.min(100, Math.max(5, data.stats.cpu + (Math.random() * 10 - 5)));
    data.stats.memory = Math.min(100, Math.max(10, data.stats.memory + (Math.random() * 5 - 2.5)));
    data.stats.latency = Math.min(200, Math.max(10, data.stats.latency + (Math.random() * 10 - 5)));
    data.stats.activeConnections = Math.max(1, data.connections.length + Math.floor(Math.random() * 3 - 1));
    
    // æ›´æ–°æ˜¾ç¤º
    updatePerformanceStats(data.stats);
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', initMonitor);
</script>

<h2><a id="content" name="content">æ¥å£ä»£ç†ç›‘æ§ä¸­å¿ƒ</a></h2>

<div class="monitor-container">
    <!-- å·¦ä¾§åˆ— -->
    <div>
        <!-- è¿æ¥åœ°å›¾é¢æ¿ -->
        <div class="monitor-panel">
            <div class="panel-header">
                <div class="panel-title">å…¨çƒè¿æ¥åˆ†å¸ƒ</div>
                <div class="panel-actions">
                    <div class="panel-btn">å®æ—¶åˆ·æ–°</div>
                    <div class="panel-btn">ç¼©æ”¾è°ƒæ•´</div>
                </div>
            </div>
            <div id="connection-map" class="map-container">
                <div class="map-placeholder">æ­£åœ¨åŠ è½½è¿æ¥åœ°å›¾...</div>
            </div>
        </div>
        
        <!-- æ€§èƒ½æŒ‡æ ‡é¢æ¿ -->
        <div class="monitor-panel">
            <div class="panel-header">
                <div class="panel-title">æ€§èƒ½æŒ‡æ ‡</div>
                <div class="panel-actions">
                    <div class="panel-btn">å†å²è¶‹åŠ¿</div>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div>CPU ä½¿ç”¨ç‡</div>
                    <div id="cpu-value" class="stat-value">0%</div>
                    <div id="cpu-gauge" class="gauge-container"></div>
                </div>
                <div class="stat-card">
                    <div>å†…å­˜ä½¿ç”¨ç‡</div>
                    <div id="memory-value" class="stat-value">0%</div>
                    <div id="memory-gauge" class="gauge-container"></div>
                </div>
                <div class="stat-card">
                    <div>å¹³å‡å»¶è¿Ÿ</div>
                    <div id="latency-value" class="stat-value">0ms</div>
                    <div id="latency-gauge" class="gauge-container"></div>
                </div>
                <div class="stat-card">
                    <div>è¿æ¥æˆåŠŸç‡</div>
                    <div id="success-value" class="stat-value">0%</div>
                    <div id="success-gauge" class="gauge-container"></div>
                </div>
            </div>
        </div>
        
        <!-- æ´»è·ƒè¿æ¥é¢æ¿ -->
        <div class="monitor-panel">
            <div class="panel-header">
                <div class="panel-title">æ´»è·ƒè¿æ¥</div>
                <div class="panel-actions">
                    <div class="panel-btn">åˆ·æ–°åˆ—è¡¨</div>
                </div>
            </div>
            <div id="active-connections"></div>
        </div>
    </div>
    
    <!-- å³ä¾§åˆ— -->
    <div>
        <!-- æµé‡ç»Ÿè®¡é¢æ¿ -->
        <div class="monitor-panel">
            <div class="panel-header">
                <div class="panel-title">æµé‡ç»Ÿè®¡</div>
                <div class="panel-actions">
                    <div class="panel-btn">ä»Šæ—¥</div>
                    <div class="panel-btn">æœ¬å‘¨</div>
                    <div class="panel-btn">æœ¬æœˆ</div>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div>æ´»è·ƒè¿æ¥æ•°</div>
                    <div id="connections-value" class="stat-value">0</div>
                    <div class="stat-label">å½“å‰åœ¨çº¿è®¾å¤‡</div>
                </div>
                <div class="stat-card">
                    <div>ä»Šæ—¥æ€»æµé‡</div>
                    <div id="traffic-value" class="stat-value">0GB</div>
                    <div class="stat-label">å…¥ç«™ + å‡ºç«™</div>
                </div>
            </div>
            <div class="traffic-chart">
                <div style="text-align:center; padding:40px 0; color:#888; font-style:italic;">
                    æµé‡è¶‹åŠ¿å›¾è¡¨å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ
                </div>
            </div>
        </div>
        
        <!-- å®¢æˆ·ç«¯æ’è¡Œé¢æ¿ -->
        <div class="monitor-panel">
            <div class="panel-header">
                <div class="panel-title">å®¢æˆ·ç«¯æµé‡æ’è¡Œ</div>
                <div class="panel-actions">
                    <div class="panel-btn">å…¨éƒ¨è®¾å¤‡</div>
                </div>
            </div>
            <div id="client-list" class="client-list"></div>
        </div>
        
        <!-- åŸŸåæ’è¡Œé¢æ¿ -->
        <div class="monitor-panel">
            <div class="panel-header">
                <div class="panel-title">åŸŸåè®¿é—®æ’è¡Œ</div>
                <div class="panel-actions">
                    <div class="panel-btn">åˆ·æ–°</div>
                </div>
            </div>
            <div id="domain-ranking" class="domain-list"></div>
        </div>
    </div>
</div>

<%+footer%>
